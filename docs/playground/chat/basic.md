# Mastra Playground: ベーシックチャット要件定義

## 目的
- Amazon Bedrock 経由で Mastra エージェントを用いたシンプルなチャット体験をローカルで検証する。
- 記憶（メモリ）やツール実行を伴わず、対話のみの API フローを確認する。
- server-only 原則に従い、クライアントにはプロンプト・レスポンス表示と入力フォームのみを提供する。

## 受入基準
- `/playground/chat/basic` にアクセスすると、サーバーコンポーネント経由でチャット UI が表示される。
- ユーザーの入力とモデルからの返答が、セッション内で順番に表示される UI を備える。
- メッセージ送信時はサーバーアクションまたは API Route（server-only）を経由し、クライアント側では推論リクエストを直接行わない。
- Bedrock モデル ID、リージョンなどは環境変数から注入され、`.env` が未設定の場合は起動時に zod バリデーションで失敗する。
- レート制限や入力制限（文字数上限）の基本ポリシーを設け、docs へリンクを提示する。
- UI は shadcn/ui コンポーネントを活用し、Playground トップページとデザインを揃える。

## 影響範囲
- **UI**: 新規ページ `app/playground/chat/basic/page.tsx` 追加、共通レイアウトとの整合確認。
- **API/サーバー**: 推論呼び出し用の server-only モジュールとアクションを新規追加。AWS 資格情報の読み込み経路を整理。
- **ツール**: ツール呼び出しは行わないが、Mastra のチャットエージェント定義を追加する必要がある。
- **ログ**: チャット送信時に構造化ログ（requestId、応答時間）を記録する仕組みを検討。
- **テスト**: チャットエージェントのユニットテスト（ダミー応答のモック）と UI レンダーテスト（重要部のみ）を整備する。

## 非機能要件
### 性能
- 単一メッセージ往復で 2 秒以内の応答を目安とし、タイムアウトや再試行の設定を環境変数から制御する。
- 依存初期化（Bedrock クライアント等）はサーバー起動時に 1 度のみ行い、各リクエストで再生成しない。

### セキュリティ
- API 呼び出し時の入力サイズ上限（例: 2,000 文字）を zod で検証し、不正な入力は 400 エラーとして扱う。
- ログに機微情報を残さず、必要最小限のメタデータのみを記録する。
- `NEXT_PUBLIC_*` 環境変数は使用しない。

## 検証方法
- `bun test` でチャットエージェントと API のユニットテストが通過すること。
- `bun lint` / `bun run typecheck` が成功すること。
- ローカルで `/playground/chat/basic` を開き、入力→送信→応答表示ができること。
- ブラウザの開発者ツールでネットワーク通信を確認し、クライアントから直接 Bedrock へアクセスしていないことを確認する。

## 今後の拡張
- ツール実行付きチャット（`/playground/chat/tools` など）追加時に再利用可能なアーキテクチャを整える。
- セッションメモリや履歴保存を導入する際は本ページを拡張する Decision Record を作成する。
- ガードレール（禁止語句フィルタ等）を含むエンタープライズ向け機能は別ページとして実装する。
